(window.webpackJsonp=window.webpackJsonp||[]).push([[18],{458:function(e,t,o){e.exports=o.p+"assets/img/12_pod_lifecycle_01.ad03f38a.png"},459:function(e,t,o){e.exports=o.p+"assets/img/12_pod_lifecycle_02.1ef98321.png"},492:function(e,t,o){"use strict";o.r(t);var a=o(32),n=Object(a.a)({},(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[a("h1",{attrs:{id:"pod-lifecycle"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#pod-lifecycle"}},[e._v("#")]),e._v(" Pod Lifecycle")]),e._v(" "),a("p",[e._v("A Pod can be extended beyond the normal operation of the container by allowing developers to:")]),e._v(" "),a("ul",[a("li",[e._v("add "),a("code",[e._v("init")]),e._v(" containers")]),e._v(" "),a("li",[e._v("add "),a("code",[e._v("pre")]),e._v(" and "),a("code",[e._v("post")]),e._v(" lifecycle hooks")]),e._v(" "),a("li",[e._v("modify the default "),a("code",[e._v("entrypoint")]),e._v(" of a container")])]),e._v(" "),a("h2",{attrs:{id:"init-containers"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#init-containers"}},[e._v("#")]),e._v(" Init Containers")]),e._v(" "),a("p",[e._v("Init containers are best used to prepare the pod for normal operation. In this lab, you will add a simple init container that posts a message to rocketchat with your pod hostname.")]),e._v(" "),a("p",[a("strong",[e._v("Objective")]),e._v(": Create an init container")]),e._v(" "),a("ul",[a("li",[e._v("From the Web Console, navigate to "),a("code",[e._v("Topology")]),e._v(" and select your "),a("code",[e._v("rocketchat-[username]")]),e._v(" deploymentconfig.")]),e._v(" "),a("li",[e._v("Navigate to the "),a("strong",[e._v("YAML")]),e._v(" tab.\n"),a("blockquote",[a("p",[e._v("If you wish to perform this from the cli with the "),a("code",[e._v("oc")]),e._v(" tool, type "),a("code",[e._v("oc edit deployment/rocketchat-[username]")])])])])]),e._v(" "),a("p",[a("img",{attrs:{src:o(458),alt:""}})]),e._v(" "),a("ul",[a("li",[e._v("Add the following section of code under "),a("code",[e._v("spec: -> template: -> spec:")])])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('      initContainers:\n      - name: init\n        image: giantswarm/tiny-tools\n        command: ["/bin/sh", "-c", "c=$(curl -X POST -H \'Content-Type: application/json\' --data \'{\\"text\\":\\"Say Hello\\"}\' https://chat.pathfinder.gov.bc.ca/hooks/xxx/xxx)"]\n')])])]),a("ul",[a("li",[e._v("Select Save")]),e._v(" "),a("li",[e._v("Ask the instructor to ensure the rocketchat instance is displayed to the class")]),e._v(" "),a("li",[e._v("Explore the "),a("code",[e._v("Pod Details")]),e._v(" to notice the differente with the Init Container")])]),e._v(" "),a("p",[a("img",{attrs:{src:o(459),alt:""}})]),e._v(" "),a("p",[e._v("In order to obtain logs from the init container, the "),a("code",[e._v("oc")]),e._v(" command can be used by specifying "),a("code",[e._v("-c init")]),e._v(":")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("oc -n [-dev] logs rocketchat-[username]-[pod-id] -c init\n")])])]),a("h2",{attrs:{id:"lifecycle-hooks"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#lifecycle-hooks"}},[e._v("#")]),e._v(" Lifecycle Hooks")]),e._v(" "),a("p",[e._v("Lifecycle hooks can be configured to start and stop a container properly. The lifecycle hook is tied directly to each container. Add a similar pre and post hook as the "),a("code",[e._v("initContainer")]),e._v(" to demonstrate when it executes in your rocketchat deployment.")]),e._v(" "),a("ul",[a("li",[e._v("From the Web Console, navigate to the "),a("code",[e._v("rocketchat-[username]")]),e._v(" deploymentconfig and click on "),a("code",[e._v("YAML")]),e._v(" tab\n"),a("ul",[a("li",[e._v("If you wish to perform this from the cli with the "),a("code",[e._v("oc")]),e._v(" tool, type "),a("code",[e._v("oc edit deployment/rocketchat-[username]")])])])]),e._v(" "),a("li",[e._v("Add the following section of code under "),a("code",[e._v("spec: -> template: -> spec: -> containers")])])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('          lifecycle:\n            postStart:\n              exec:\n                command:  ["/bin/sh", "-c", "c=$(curl -X POST -H \'Content-Type: application/json\' --data \'{\\"text\\": \\"\'\\"$HOSTNAME\\"\' is at the postStart phase, huzzah! \\"}\' https://chat.pathfinder.gov.bc.ca/hooks/xxx/xxx)"]\n            preStop:\n              exec:\n                command:  ["/bin/sh", "-c", "c=$(curl -X POST -H \'Content-Type: application/json\' --data \'{\\"text\\": \\"\'\\"$HOSTNAME\\"\' is just about to STOPPPPPP! \\"}\' https://chat.pathfinder.gov.bc.ca/hooks/xxx/xxx)"]\n')])])]),a("ul",[a("li",[e._v("Select Save")]),e._v(" "),a("li",[e._v("Ask the instructor to ensure the rocketchat instance is displayed to the class")])]),e._v(" "),a("h2",{attrs:{id:"overriding-the-entrypoint"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#overriding-the-entrypoint"}},[e._v("#")]),e._v(" Overriding the Entrypoint")]),e._v(" "),a("p",[e._v("It may be necessary, from time to time, to override the initial command/entrypoint of a container image. Generally this is used for troubleshooting purposes, or to override a vendor provided image.")]),e._v(" "),a("ul",[a("li",[e._v("From the Web Console, navigate to the "),a("code",[e._v("rocketchat-[username]")]),e._v(" deploymentconfig and click on "),a("code",[e._v("YAML")]),e._v(" tab\n"),a("ul",[a("li",[e._v("If you wish to perform this from the cli with the "),a("code",[e._v("oc")]),e._v(" tool, type "),a("code",[e._v("oc edit deployment/rocketchat-[username]")])])])]),e._v(" "),a("li",[e._v("Add the following section of code under "),a("code",[e._v("spec: -> template: -> spec: -> containers")])])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('          command:  ["/bin/sh", "-c", "c=$(curl -X POST -H \'Content-Type: application/json\' --data \'{\\"text\\": \\"\'\\"$HOSTNAME\\"\' is AN OVERRIDING COMMAND! \\"}\' https://chat.pathfinder.gov.bc.ca/hooks/xxx/xxx)"]\n')])])]),a("ul",[a("li",[e._v("Take note of the pattern that will happen in the rocketchat notification screen")]),e._v(" "),a("li",[e._v("Remove the previous command to enable the rocketchat instance to start properly again")])]),e._v(" "),a("h2",{attrs:{id:"references"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#references"}},[e._v("#")]),e._v(" References")]),e._v(" "),a("ul",[a("li",[e._v("https://blog.openshift.com/kubernetes-pods-life/")])])])}),[],!1,null,null,null);t.default=n.exports}}]);